---
title: "q2_JD"
output: html_document
---
```{r setup}
library(readr)
library(forecast)
library(xts)
getwd()
library(dplyr)
library(fpp)
library(fpp3)
library(gridExtra)
library(ggplot2)
library(ranger)
library(ftsa)
```
#Step 1 read the csv datasets files
```{r}
data = read.csv("Projectdata.csv")
```


```{r}
tsdata <- xts(data[,2:19], as.Date(data$date))
tsdata
```
```

#Step 2 perform training and testing data split
split: 70-30
```{r} 
split1<- sample(c(rep(0, 0.7 * nrow(tsdata)), rep(1, 0.3 * nrow(tsdata))))
table(split1) 
train1 <- head(tsdata, 1378)
test1 <- tail(tsdata, 591)
test1
```

split: 80-20
```{r}
split2<- sample(c(rep(0, 0.8 * nrow(data)), rep(1, 0.2 * nrow(data))))
table(split2) 
train2 <- head(tsdata, 1575)
test2 <- tail(tsdata, 394)
```

split: 90-10
```{r}
split3<- sample(c(rep(0, 0.9 * nrow(data)), rep(1, 0.1 * nrow(data))))
table(split3) 
train3 <- head(tsdata, 1772)
test3 <- tail(tsdata, 197)
```

#Step 3 fit the models of Naive, sNaive, ESX, HW, ES, MA

train_names <- c('train1', 'train2', 'train3')
test_names <- c('test1', 'test2', 'test3')
variables <- colnames(train1)

# Naive

for (i in 1:length(train_names)){
  for (n in 1:length(variables)){
    naivef <- naive(get(paste0("train",i))[,n], h=1)
    print(paste0("train",i))
    print(colnames(get(paste0("train",i))[,n]))
    print(summary(naivef))
  }
}

# sNaive

for (i in 1:length(train_names)){
  for (n in 1:length(variables)){
    snaivef <- snaive(get(paste0("train",i))[,n], h=2*30)
    print(paste0("train",i))
    print(colnames(get(paste0("train",i))[,n]))
    print(summary(snaivef))
  }
}

# ES

for (i in 1:length(train_names)){
  for (n in 1:length(variables)){
    esf <- ses(get(paste0("train",i))[,n], h=1)
    print(paste0("train",i))
    print(colnames(get(paste0("train",i))[,n]))
    print(summary(esf))
  }
}

# MA

for (i in 1:length(train_names)){
  for (n in 1:length(variables)){
    maf <- forecast(ma(get(paste0("train",i))[,n], order = 15), h=1)
    print(paste0("train",i))
    print(colnames(get(paste0("train",i))[,n]))
    print(summary(esf))
  }
}


#SARIMA
for (i in 1:length(train_names)){
  for (n in 1:length(variables)){
    sarima<-forecast(auto.arima(get(paste0("train",i))[,n],D=1,seasonal=TRUE), h=1)
    print(paste0("train",i))
    print(colnames(get(paste0("train",i))[,n]))
    print(summary(sarima))
  }
}


#try with 1 split and 1 variable forecast first
```{r}



```


#3.1 ESX
```{r}
## Holt-Winters
```

```

#3.2 HW
```{r}
## Holt-Winters
#a. fit the models
tsdata1 <- train1[,0:1]
hw1 <- HoltWinters(tsdata1, gamma = FALSE)
hw1$SSE
```
```{r}
#c. one step ahead
tsdata2 <- test1[,1]
hw1_p <- forecast(hw1, h=1)
```
```{r}
#d. loss function
hwmse <- (hw1_p$mean - as.numeric(test1[1,1]))^2 #mse
hwmae <- abs(hw1_p$mean - as.numeric(test1[1,1])) #mae
```
```{r}
#f. test and train comparison
hw1_test <- HoltWinters(tsdata1,  alpha = 0.215355, beta = 0.112057, seasonal = "additive" , gamma = FALSE)
plot(hw1_test)
hw1_test$SSE
```

#3 h = 1-28
```{r}
for (i in 1:28){
  hw1_p <- forecast(hw1, h=i)
} 

```


```{r}
#rmsse functions 
library(Metrics)
rmse_num=rmse(test$Hobbies_CA_1, test$y_hat)

rmsse_denom=1/((nrow(test)-1))*sum(diff((test$Hobbies_CA_1))^2) %>% sqrt()##hh to make sure that starts form t=2

rmse_num/rmsse_denom #final value

```

```{r}

```


# 3 ES
```{r}
## Exponential smoothing
```
#a. fit the models
tsdata1 <- train1[,0:1]
es1 <- ses(tsdata1, , beta=FALSE, gamma=FALSE)

#c. one step ahead
tsdata2 <- test1[,1]
es1_p <- forecast(es1, h=1)

```
```{r}
#d. loss function
esmse <- (es1_p$mean - as.numeric(test1[1,1]))^2 #mse
esmae <- abs(es1_p$mean - as.numeric(test1[1,1])) #mae


# 4 MA
```{r}
## MA-15
```
#a. fit the models
ma1 <- ma(tsdata1, order = 15)


#c. one step ahead
tsdata2 <- test1[,1]
ma1_p <- forecast(ma1, h=1)

```
```{r}
#d. loss function
mamse <- (ma1_p$mean - as.numeric(test1[1,1]))^2 #mse
mamae <- abs(ma1_p$mean - as.numeric(test1[1,1])) #mae



